From 8362ad897f77d5e03edc41a54dc4cfc30f227c03 Mon Sep 17 00:00:00 2001
From: Cristian Anton <canton@randstad.com.ar>
Date: Sun, 14 May 2023 01:30:58 -0300
Subject: [PATCH] Le hice cambios en sucursal

---
 .env                             |  8 ++++----
 src/config/DBConfig.ts           |  2 +-
 src/controllers/sucursal.ts      | 12 ++++++------
 src/routes/sucursal.ts           |  6 +++---
 src/services/sucursalServices.ts |  7 ++++---
 5 files changed, 18 insertions(+), 17 deletions(-)

diff --git a/.env b/.env
index b6e9cfc..0c37dd2 100644
--- a/.env
+++ b/.env
@@ -1,8 +1,8 @@
 PORT=3000
-HOST=cambiodbtest.cjwysjzudbc8.us-east-1.rds.amazonaws.com
+HOST=192.168.1.141
 PORTDB=3306
-USER=admin
-PASSWORD=ojoseco1
-DATABASE=DB_RDS_AWS
+USER=root
+PASSWORD=ojoseco6971
+DATABASE=cambiotest
 JWT_SECRET=Spaghetti_Western_Trotamundo
 NODE_ENV=testaws 
\ No newline at end of file
diff --git a/src/config/DBConfig.ts b/src/config/DBConfig.ts
index 74dd663..fb6dee6 100644
--- a/src/config/DBConfig.ts
+++ b/src/config/DBConfig.ts
@@ -14,7 +14,7 @@ const DBConfig = new DataSource({
     extra: {
         connectionLimit: 50,
     },
-    synchronize: true
+    //synchronize: true
 })
 
 
diff --git a/src/controllers/sucursal.ts b/src/controllers/sucursal.ts
index b713051..69e5313 100644
--- a/src/controllers/sucursal.ts
+++ b/src/controllers/sucursal.ts
@@ -29,8 +29,8 @@ const delSucursal = async ({params}:Request, res:Response) =>{
 const getAllSurcursales = async (req:Request, res:Response) => {
     try {
         const sucursalesFound = await viewAllSucursales();
-        if(sucursalesFound) throw "No hay usuarios en la base de datos"
-        res.send(sucursalesFound)
+        if(!sucursalesFound) throw "No hay usuarios en la base de datos"
+        res.send(sucursalesFound).status(StatusCodes.OK)
     } catch (error) {
         res.status(StatusCodes.NOT_FOUND).send(error)
     }
@@ -38,9 +38,9 @@ const getAllSurcursales = async (req:Request, res:Response) => {
 
 const getOneSucursal = async ({params}:Request, res:Response)=>{
     try {
-        const name : string = params.name
-        const sucursalFound = await viewOneSucursales({name})
-        if(sucursalFound) throw "No se encontro la sucursal"
+        const id = parseInt(params.id)
+        const sucursalFound = await viewOneSucursales({id})
+        if(!sucursalFound) throw "No se encontro la sucursal"
         res.send(sucursalFound)
     } catch (error) {
         res.status(StatusCodes.NOT_FOUND).send(error)
@@ -60,4 +60,4 @@ const putSucursal = async ({body, params}:Request, res:Response) => {
 }
 
 
-export{newSucursal, delSucursal, getAllSurcursales, getOneSucursal}
\ No newline at end of file
+export{newSucursal, delSucursal, getAllSurcursales, getOneSucursal, putSucursal}
\ No newline at end of file
diff --git a/src/routes/sucursal.ts b/src/routes/sucursal.ts
index 6acfe08..da83d65 100644
--- a/src/routes/sucursal.ts
+++ b/src/routes/sucursal.ts
@@ -1,12 +1,12 @@
 import { Router } from 'express';
-import { delSucursal, getAllSurcursales, getOneSucursal, newSucursal } from '../controllers/sucursal';
+import { delSucursal, getAllSurcursales, getOneSucursal, newSucursal , putSucursal} from '../controllers/sucursal';
 
 
 
 const router = Router()
 
 //Get One
-router.get('/:name', getOneSucursal)
+router.get('/:id', getOneSucursal)
 
 //Get All
 router.get('', getAllSurcursales)
@@ -15,7 +15,7 @@ router.get('', getAllSurcursales)
 router.delete('/:name', delSucursal)
 
 //Put-Patch
-router.patch('', ()=>{})
+router.patch('', putSucursal)
 
 //Post 
 router.post('',newSucursal)
diff --git a/src/services/sucursalServices.ts b/src/services/sucursalServices.ts
index 66009af..bdae3a4 100644
--- a/src/services/sucursalServices.ts
+++ b/src/services/sucursalServices.ts
@@ -49,13 +49,14 @@ const deleteSucursal = async ({name}: SucursalDTO) =>{
 const viewAllSucursales = async () => {
   await initRepo();
   const sucursalesFound = await SucursalRepository.find();
-  if(sucursalesFound.length === 0) return false;
+  if(!sucursalesFound) return false;
   return sucursalesFound;
 }
 
-const viewOneSucursales = async ({name} : SucursalDTO) =>{
+const viewOneSucursales = async ({id} : SucursalDTO) =>{
   await initRepo();
-  const sucursalFound = await SucursalRepository.findOne({where:{name}})
+  const sucursalFound = await SucursalRepository.findOne({where:{id}})
+  console.log(sucursalFound)
   if(!sucursalFound) return false;
   return sucursalFound;
 }
-- 
2.35.1.windows.2

